<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Budget Summary</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Theme-specific styles from Home.html */
    .theme-candy { background-color: #ff80bf; color: #fff; --accent: #ff3399; }
    .theme-bleed { background-color: #e20074; color: #fff; --accent: #ff66b2; }
    .theme-midnight { background-color: #002b36; color: #839496; --accent: #b58900; }
    .theme-sea { background-color: #1c2526; color: #c3e6cb; --accent: #4db6ac; }
    .theme-howl { background-color: #011627; color: #d6deeb; --accent: #82aaff; }
    .theme-dawn { background-color: #2d2e2c; color: #fff; --accent: #ff7043; }
    .theme-night { background-color: #1e222a; color: #abb2bf; --accent: #98c379; }
    .theme-drank { background-color: #0f111a; color: #acb4c2; --accent: #5c6370; }
    .theme-eve { background-color: #f4eefd; color: #4b294b; --accent: #d08770; }
    .theme-gray { background-color: #3c3c3c; color: #cccccc; --accent: #87afaf; }
    .theme-ocean { background-color: #2b303b; color: #c0c5ce; --accent: #8fa1b3; }
    .theme-auro { background-color: #1b1e2b; color: #e6e6e6; --accent: #ff6f61; }
    .theme-pm { background-color: #2c1d4b; color: #d7d7ff; --accent: #957fb8; }
    .theme-ember { background-color: #1b1818; color: #d4b7a3; --accent: #ff6b6b; }
    .theme-flare { background-color: #451804; color: #f4e6a2; --accent: #ff4500; }

    /* Text color adjustments for readability */
    .theme-candy main, .theme-candy header, .theme-candy a,
    .theme-eve main, .theme-eve header, .theme-eve a {
      color: #000;
    }
    .theme-bleed main, .theme-bleed header, .theme-bleed a,
    .theme-midnight main, .theme-midnight header, .theme-midnight a,
    .theme-sea main, .theme-sea header, .theme-sea a,
    .theme-howl main, .theme-howl header, .theme-howl a,
    .theme-dawn main, .theme-dawn header, .theme-dawn a,
    .theme-night main, .theme-night header, .theme-night a,
    .theme-drank main, .theme-drank header, .theme-drank a,
    .theme-gray main, .theme-gray header, .theme-gray a,
    .theme-ocean main, .theme-ocean header, .theme-ocean a,
    .theme-auro main, .theme-auro header, .theme-auro a,
    .theme-pm main, .theme-pm header, .theme-pm a,
    .theme-ember main, .theme-ember header, .theme-ember a,
    .theme-flare main, .theme-flare header, .theme-flare a {
      color: #fff;
    }

    /* Apply accent color to back button */
    .back-btn {
      background-color: var(--accent);
      color: #fff;
      border: none;
    }
    .back-btn:hover {
      background-color: #343a40;
    }

    /* Ensure table and dropdowns are readable */
    .theme-candy .table, .theme-eve .table,
    .theme-candy .month-display, .theme-eve .month-display,
    .theme-candy .year-display, .theme-eve .year-display,
    .theme-candy .month-dropdown, .theme-eve .month-dropdown,
    .theme-candy .year-dropdown, .theme-eve .year-dropdown {
      background-color: #fff/color: #000;
      border-color: #4b5563;
    }
    .theme-candy .month-dropdown-item, .theme-eve .month-dropdown-item,
    .theme-candy .year-dropdown-item, .theme-eve .year-dropdown-item {
      color: #000;
    }
    .theme-candy .month-dropdown-item:hover, .theme-eve .month-dropdown-item:hover,
    .theme-candy .year-dropdown-item:hover, .theme-eve .year-dropdown-item:hover {
      background-color: #e5e7eb;
    }
    .theme-candy h1, .theme-candy h4, .theme-eve h1, .theme-eve h4 {
      color: #000;
    }

    /* Compact styles */
    body {
      padding: 10px; /* Reduced from 20px */
      transition: background-color 0.3s, color 0.3s;
    }
    h1 {
      font-size: 1.5rem; /* Reduced from default ~2rem */
      text-align: center; /* Center the header */
      margin-bottom: 1rem; /* Reduced spacing */
      color: inherit;
    }
    h4 {
      font-size: 1rem; /* Reduced from default ~1.25rem */
      color: inherit;
    }
    .summary-section {
      margin-bottom: 15px; /* Reduced from 30px */
    }
    .table {
      background-color: #2c2f36;
      border: 1px solid #444;
      border-radius: 6px; /* Slightly smaller */
      overflow: hidden;
      font-size: 0.85rem; /* Smaller text */
    }
    .table th, .table td {
      border: 1px solid #444;
      padding: 4px; /* Reduced from 8px */
      vertical-align: middle;
    }
    .date-selector-grid {
      position: absolute;
      top: 5px; /* Closer to top */
      right: 30px; /* Slightly adjusted */
      display: flex;
      gap: 5px; /* Reduced from 10px */
    }
    .month-selector, .year-selector {
      position: relative;
    }
    .month-display, .year-display {
      font-size: 0.8rem; /* Reduced from 14px */
      padding: 4px 8px; /* Reduced from 8px 12px */
      background-color: #2c2f36;
      border: 1px solid #444;
      border-radius: 6px; /* Slightly smaller */
      min-width: 80px; /* Reduced from 100px */
      text-align: center;
      cursor: pointer;
    }
    .month-display-text, .year-display-text {
      display: inline-block;
    }
    .month-dropdown, .year-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      z-index: 1000;
      display: none;
      background-color: #2c2f36;
      border: 1px solid #444;
      border-radius: 6px;
      min-width: 80px;
      max-height: 150px; /* Reduced from 200px */
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #444 #2c2f36;
      font-size: 0.8rem; /* Smaller text */
    }
    .month-dropdown.show, .year-dropdown.show {
      display: block;
    }
    .month-dropdown-item, .year-dropdown-item {
      padding: 4px 8px; /* Reduced from 8px 12px */
      color: #f8f9fa;
      text-decoration: none;
      display: block;
      cursor: pointer;
    }
    .month-dropdown-item:hover, .year-dropdown-item:hover {
      background-color: #343a40;
    }
    .back-btn {
      position: fixed;
      bottom: 10px; /* Closer to bottom */
      right: 10px; /* Closer to right */
      padding: 6px 10px; /* Reduced from 8px 12px */
      border-radius: 10px; /* Slightly smaller */
      text-decoration: none;
      font-size: 0.85rem; /* Smaller text */
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Budget Summary</h1>

    <!-- Month and Year Selector -->
    <div class="date-selector-grid">
      <div class="month-selector">
        <span class="month-display" onclick="toggleMonthDropdown()"><span class="month-display-text" id="month-display">March</span></span>
        <div class="month-dropdown" id="month-dropdown">
          <a class="month-dropdown-item" onclick="selectMonth('jan')">January</a>
          <a class="month-dropdown-item" onclick="selectMonth('feb')">February</a>
          <a class="month-dropdown-item" onclick="selectMonth('mar')">March</a>
          <a class="month-dropdown-item" onclick="selectMonth('apr')">April</a>
          <a class="month-dropdown-item" onclick="selectMonth('may')">May</a>
          <a class="month-dropdown-item" onclick="selectMonth('jun')">June</a>
          <a class="month-dropdown-item" onclick="selectMonth('jul')">July</a>
          <a class="month-dropdown-item" onclick="selectMonth('aug')">August</a>
          <a class="month-dropdown-item" onclick="selectMonth('sep')">September</a>
          <a class="month-dropdown-item" onclick="selectMonth('oct')">October</a>
        </div>
      </div>
      <div class="year-selector">
        <span class="year-display" onclick="toggleYearDropdown()"><span class="year-display-text" id="year-display">2025</span></span>
        <div class="year-dropdown" id="year-dropdown">
          <a class="year-dropdown-item" onclick="selectYear(2025)">2025</a>
          <a class="year-dropdown-item" onclick="selectYear(2026)">2026</a>
          <a class="year-dropdown-item" onclick="selectYear(2027)">2027</a>
          <a class="year-dropdown-item" onclick="selectYear(2028)">2028</a>
          <a class="year-dropdown-item" onclick="selectYear(2029)">2029</a>
          <a class="year-dropdown-item" onclick="selectYear(2030)">2030</a>
          <a class="year-dropdown-item" onclick="selectYear(2031)">2031</a>
          <a class="year-dropdown-item" onclick="selectYear(2032)">2032</a>
          <a class="year-dropdown-item" onclick="selectYear(2033)">2033</a>
          <a class="year-dropdown-item" onclick="selectYear(2034)">2034</a>
        </div>
      </div>
    </div>

    <!-- Daily Summary -->
    <div class="summary-section">
      <h4>Daily Summary for <span id="daily-title">March 2025</span></h4>
      <table class="table">
        <thead>
          <tr>
            <th>Day</th>
            <th>Income (₱)</th>
            <th>Expenses (₱)</th>
            <th>Balance (₱)</th>
          </tr>
        </thead>
        <tbody id="daily-summary-table">
          <!-- Dynamic rows will be added here -->
        </tbody>
      </table>
    </div>

    <!-- Monthly Summary -->
    <div class="summary-section">
      <h4>Monthly Summary for <span id="monthly-title">2025</span></h4>
      <table class="table">
        <thead>
          <tr>
            <th>Month</th>
            <th>Income (₱)</th>
            <th>Expenses (₱)</th>
            <th>Balance (₱)</th>
          </tr>
        </thead>
        <tbody id="monthly-summary-table">
          <!-- Dynamic rows will be added here -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Back Button -->
  <a href="Month.html" class="back-btn">Back</a>

  <script>
    // Load and apply saved theme
    const savedTheme = localStorage.getItem('selectedTheme') || 'candy';
    document.body.className = `theme-${savedTheme}`;

    let currentMonth = 'mar';
    let currentYear = 2025;

    const monthNames = {
      jan: 'January', feb: 'February', mar: 'March', apr: 'April', may: 'May', jun: 'June',
      jul: 'July', aug: 'August', sep: 'September', oct: 'October', nov: 'November', dec: 'December'
    };

    const monthOrder = ['jan', 'feb', 'mar', 'apr', 'may', 'jun', 'jul', 'aug', 'sep', 'oct', 'nov', 'dec'];
    const yearOrder = Array.from({length: 26}, (_, i) => 2025 + i);

    function getDaysInMonth(month, year) {
      const monthIndex = monthOrder.indexOf(month);
      if (monthIndex === 1) {
        const isLeapYear = (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
        return isLeapYear ? 29 : 28;
      }
      if ([3, 5, 8, 10].includes(monthIndex)) {
        return 30;
      }
      return 31;
    }

    function toggleMonthDropdown() {
      const monthDropdown = document.getElementById('month-dropdown');
      const yearDropdown = document.getElementById('year-dropdown');
      monthDropdown.classList.toggle('show');
      yearDropdown.classList.remove('show');
    }

    function toggleYearDropdown() {
      const monthDropdown = document.getElementById('month-dropdown');
      const yearDropdown = document.getElementById('year-dropdown');
      yearDropdown.classList.toggle('show');
      monthDropdown.classList.remove('show');
    }

    function selectMonth(month) {
      currentMonth = month;
      updateSummaries();
      document.getElementById('month-dropdown').classList.remove('show');
    }

    function selectYear(year) {
      currentYear = year;
      updateSummaries();
      document.getElementById('year-dropdown').classList.remove('show');
    }

    function updateSummaries() {
      document.getElementById('daily-title').textContent = `${monthNames[currentMonth]} ${currentYear}`;
      document.getElementById('monthly-title').textContent = currentYear;
      document.getElementById('month-display').textContent = monthNames[currentMonth];
      document.getElementById('year-display').textContent = currentYear;

      // Daily Summary
      const dailyTable = document.getElementById('daily-summary-table');
      dailyTable.innerHTML = '';
      const daysInMonth = getDaysInMonth(currentMonth, currentYear);
      for (let day = 1; day <= daysInMonth; day++) {
        const data = JSON.parse(localStorage.getItem(`budget_${currentYear}_${currentMonth}_${day}`)) || {};
        const incomeList = data.incomeList || [];
        const expenseList = data.expenseList || [];
        const totalIncome = incomeList.reduce((sum, amount) => sum + amount, 0);
        const totalExpense = expenseList.reduce((sum, expense) => sum + parseFloat(expense.amount || 0), 0);
        const balance = totalIncome - totalExpense;
        if (totalIncome > 0 || totalExpense > 0) {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${day}</td>
            <td>${totalIncome.toFixed(2)}</td>
            <td>${totalExpense.toFixed(2)}</td>
            <td>${balance.toFixed(2)}</td>
          `;
          dailyTable.appendChild(row);
        }
      }

      // Monthly Summary
      const monthlyTable = document.getElementById('monthly-summary-table');
      monthlyTable.innerHTML = '';
      monthOrder.forEach(month => {
        let totalIncome = 0;
        let totalExpense = 0;
        const days = getDaysInMonth(month, currentYear);
        for (let day = 1; day <= days; day++) {
          const data = JSON.parse(localStorage.getItem(`budget_${currentYear}_${month}_${day}`)) || {};
          const incomeList = data.incomeList || [];
          const expenseList = data.expenseList || [];
          totalIncome += incomeList.reduce((sum, amount) => sum + amount, 0);
          totalExpense += expenseList.reduce((sum, expense) => sum + parseFloat(expense.amount || 0), 0);
        }
        const balance = totalIncome - totalExpense;
        if (totalIncome > 0 || totalExpense > 0) {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${monthNames[month]}</td>
            <td>${totalIncome.toFixed(2)}</td>
            <td>${totalExpense.toFixed(2)}</td>
            <td>${balance.toFixed(2)}</td>
          `;
          monthlyTable.appendChild(row);
        }
      });
    }

    function makeDropdownDraggable(dropdownId) {
      const dropdown = document.getElementById(dropdownId);
      let isDragging = false;
      let startY, startScrollTop;

      dropdown.addEventListener('mousedown', (e) => {
        if (e.target.classList.contains(dropdownId + '-item')) return;
        isDragging = true;
        startY = e.clientY;
        startScrollTop = dropdown.scrollTop;
        e.preventDefault();
      });

      document.addEventListener('mousemove', (e) => {
        if (isDragging) {
          const deltaY = startY - e.clientY;
          dropdown.scrollTop = startScrollTop + deltaY;
        }
      });

      document.addEventListener('mouseup', () => {
        isDragging = false;
      });
    }

    window.onload = function() {
      updateSummaries();
      makeDropdownDraggable('month-dropdown');
      makeDropdownDraggable('year-dropdown');
    };

    document.addEventListener('click', function(event) {
      const monthDisplay = document.querySelector('.month-display');
      const yearDisplay = document.querySelector('.year-display');
      const monthDropdown = document.getElementById('month-dropdown');
      const yearDropdown = document.getElementById('year-dropdown');
      if (!monthDisplay.contains(event.target) && !monthDropdown.contains(event.target)) {
        monthDropdown.classList.remove('show');
      }
      if (!yearDisplay.contains(event.target) && !yearDropdown.contains(event.target)) {
        yearDropdown.classList.remove('show');
      }
    });
  </script>
</body>
</html>